## 프록시 패턴과 프록시 서버

프록시 객체는 사실 디자인 패턴 중 하나인 프록시 패턴이 녹아들어 있는 객체

### 프록시 패턴

- 프록시 패턴은 대상 객체(subject)에 접근하기 전 그 접근에 대한 흐름을 가로채 해당 접근을 필터링하거나 수정하는 등의 역할을 하는 계층이 있는 디자인 패턴
- 이를 통해 객체의 속성, 변환 등을 보완하며 보안, 데이터 검증, 캐싱, 로깅에 사용한다.
- 이는 앞서 설명한 프록시 객체로 쓰이기도 하지만 프록시 서버로도 활용된다.

---

### 프록시 서버에서의 캐싱

캐시 안에 정보를 담아두고, 캐시 안에 있는 정보를 요구하는 요청에 대해 다시 저 멀리 있는 원격 서버에 요청하지 않고 캐시 안에 있는 데이터를 활용하는 것을 말한다.

이를 통해 불필요하게 외부와 연결하지 않기 때문에 트래픽을 줄일 수 있다는 장점이 있다.

---

### 프록시서버

서버와 클라이언트 사이에서 클라이언트가 자신을 통해 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해주는 컴퓨터 시스템이나 응용프로그램을 가리킨다.

### 프록시 서버로 쓰는 nginx

- nginx는 비동기 이벤트 기반의 구조와 다수의 연결을 효과적으로 처리 가능한 웹 서버이며, 주로 Node.js 서버 앞단의 프록시 서버로 활용됩니다.
- 라이언 달 “Node.js의 버퍼 오버플로우 취약점을 예방하기 위해서는 nginx를 프록시 서버 앞단에 놓고 Node.js를 뒤쪽에 놓는것이 좋다”
- nginx를 서버 구축 시 앞단에 두면서 익명 사용자가 직접적으로 서버에 접근하는 것을 차단하고, 간접적으로 한 단계를 더 거치게 만들어서 보안을 강화할 수 있음
- nginx를 프록시 서버로 둬서 실제 포트를 숨길 수 있고 정적자원을 gzip 압축하거나 메인 서버 앞단에서의 로깅을 할 수 있다.
- (Client) → (Nginx) → (Proxy Server) → (Backend Server) 기본구조

---

### 버퍼 오버플로우

버퍼는 보통 데이터가 저장되는 메모리 공간으로, 메모리 공간을 벗어나는 경우를 말함.

이때 사용되지 않아야 할 영역에 데이터가 덮어씌워져 주소, 값을 바꾸는 공격이 발생하기도 한다.

- gzip 압축
  - gzip압축을 하면 데이터 전송량을 줄일 수 있지만, 압축을 해제했을 때 서버에서의 CPU 오버헤드도 생각해서 gzip 압축 사용 유무를 결정해야함.

---

### 프록시 서버로 쓰는 CloudFlare

- CloudFlare는 전 세계적으로 분산된 서버가 있고 이를 통해 어떠한 시스템의 콘텐츠 전달을 빠르게 할 수 있는 CDN 서비스임.
- CloudFlare는 웹 서버 앞단에 프록시 서버로 두어 DDOS 공격 방어나 HTTPS 구축에 쓰인다.
- 또한, 서비스를 배포한 이후에 해외에서 무언가 의심스러운 트래픽이 많이 발생하면 이 때문에 많은 클라우드 서비스 비용이 발생할 수도 있는데, 이때 CloudFlare가 의심스러운 트래픽인지를 먼저 판단해 CAPTCHA등을 기반으로 이를 일정부분 막아주는 역할도 수행한다.

1. DDOS 공격 방어

- DDOS는 짧은 시간 동안 네트워크에 많은 요청을 보내 네트워크를 마비시켜 웹 사이트의 가용성을 방해하는 사이버 공격 유형임
- CloudFlare는 사용자가 접속하는 것이 아닌 시스템을 통해 오는 트래픽을 자동으로 차단해서 DDOS 공격으로부터 보호한다.
- CloudFlare의 거대한 네트워크 용량과 캐싱 전략으로 소규모 DDOS 공격은 쉽게 막아낼 수 있으며 이런 공격에 대한 방화벽 대시보드도 제공한다.

1. HTTPS 구축

- 서버에서 HTTPS를 구축할 때 인증서를 기반으로 구축할 수도 있다.
- 하지만, CloudFlare를 사용하면 별도의 인증서 설치 없이 좀 더 손쉽게 HTTPS를 구축할 수 있다.

---

### CDN(Content Delivery Network)

- 각 사용자가 인터넷에 접속하는 곳과 가까운 곳에서 콘텐츠를 캐싱 또는 배포하는 서버 네트워크를 말한다.
- 이를 통해 사용자가 웹 서버로부터 콘텐츠를 다운로드하는 시간을 줄일 수 있다.

---

### CORS와 프런트엔드의 프록시 서버

- CORS(Cross-Origin Resource Sharing)는 서버가 웹 브라우저에서 리소스를 로드할 때 다른 오리진을 통해 로드하지 못하게 하는 HTTP 헤더 기반 메커니즘
- 프론트 개발 시 프론트 서버를 만들어서 백엔드 서버와 통신할 때 주로 CORS 에러를 마주치는데, 이를 해결하기 위해 프론트에서 서버를 만들기도 한다.
- 예를 들어 프론트에서는 127.0.0.1:3000으로 테스팅하는데 백엔드 서버는 127.0.0.1:12010 이라면 포트번호가 다르기 때문에 CORS에러가 나타난다.
- 이때 프록시 서버를 둬서 프런트엔트 서버에서 요청되는 오리진을 127.0.0.1:12010으로 바꾼다.
- 참고로 127.0.0.1이란 루프백(loopback) IP로, 본인 PC 서버의 IP를 뜻함.
- localhost나 127.0.0.1을 주소창에 입력하면 DNS 거치지 않고 바로 본인 PC서버로 연결된다.
- 서버 앞단에 프록시 서버를 놓아 /api 요청은 users API, /api2 요청은 users API2에 요청할 수 있다.
- CORS 에러 해결은 물론이며 다양한 API 서버와의 통신도 매끄럽게 할 수 있다.

---

### 오리진

- 프로토콜과 호스트 이름, 포트의 조합.
- 예를 들어 [http://kulkul.com:12010/test](http://kundol.com:12010/test) 에서 오리진은 https://kulkul.com:12010 이 된다.

---

### **프록시 서버(Proxy Server)란?**

프록시 서버는 클라이언트와 원격 서버(예: 웹사이트) 사이에서 중개 역할을 하는 서버입니다. 사용자의 요청을 대신 수행하고, 응답을 다시 사용자에게 전달하는 방식으로 작동합니다.

---

## **1. 프록시 서버의 기본 개념**

- **클라이언트 → 프록시 서버 → 원격 서버**
- 클라이언트는 직접 원격 서버에 접근하지 않고, 프록시 서버를 통해 접근함.
- 프록시 서버는 요청을 대신 처리하고, 원격 서버에서 받은 데이터를 클라이언트에 반환.

### **2. 프록시 서버의 역할**

- **익명성 제공:** 사용자의 IP 주소를 숨겨 프라이버시 보호.
- **속도 향상:** 자주 방문하는 웹사이트를 캐싱하여 빠른 응답 제공.
- **보안 강화:** 악성 웹사이트 차단 및 데이터 필터링.
- **접근 제어:** 특정 웹사이트 차단 또는 제한적인 네트워크 접근 설정 가능.

---

## **3. 프록시 서버의 종류**

### **① 정방향 프록시 (Forward Proxy)**

- 일반적으로 사용자가 인터넷을 이용할 때 쓰는 프록시.
- 클라이언트가 요청을 보내면 프록시가 이를 원격 서버에 전달한 후, 응답을 다시 클라이언트에게 반환.

📌 **예제:** 기업 내부망에서 직원들의 인터넷 사용을 모니터링하고 제어하는 경우.

---

### **② 리버스 프록시 (Reverse Proxy)**

- 원격 서버 앞단에서 클라이언트의 요청을 대신 처리.
- 주로 보안 강화, 부하 분산(로드 밸런싱) 등의 목적으로 사용됨.

📌 **예제:**

- Nginx를 이용하여 여러 개의 웹 서버로 트래픽을 분산하는 경우.
- DDoS 공격 방어 및 SSL 암호화를 위한 중개 서버 역할 수행.

---

### **③ 웹 프록시 (Web Proxy)**

- 주로 웹 브라우저에서 특정 사이트 차단을 우회하거나, 캐싱을 통해 웹사이트 접속 속도를 높이는 용도로 사용됨.

📌 **예제:**

- 학교나 회사에서 유튜브 같은 특정 사이트 접근을 차단하는 경우.
- VPN과 유사하게 차단된 콘텐츠를 우회하는 기능 제공.

---

### **④ 투명 프록시 (Transparent Proxy)**

- 사용자가 인지하지 못한 채 네트워크 관리자에 의해 적용되는 프록시.
- 기업이나 공공기관에서 네트워크 트래픽을 모니터링할 때 사용됨.

📌 **예제:**

- 기업이 직원의 인터넷 사용을 감시할 때.
- 공공 Wi-Fi에서 사용자 트래픽을 모니터링하는 경우.

---

### **⑤ SOCKS 프록시 (SOCKS Proxy)**

- 웹뿐만 아니라 FTP, P2P, 게임 등 다양한 프로토콜에서 사용할 수 있는 다목적 프록시.
- 속도는 느리지만 더 높은 수준의 익명성을 제공.

📌 **예제:**

- 다크웹 접속을 위한 TOR 네트워크.
- 특정 국가에서 차단된 서비스 이용.

---

## **4. 프록시 서버와 VPN의 차이**

| **비교 항목**     | **프록시 서버**               | **VPN**                        |
| ----------------- | ----------------------------- | ------------------------------ |
| **IP 주소 숨김**  | 제한적 (일부 숨김)            | 완전한 숨김                    |
| **트래픽 암호화** | X (일반적으로 암호화 없음)    | O (강력한 암호화)              |
| **속도**          | 빠름 (캐싱 지원)              | 느림 (암호화로 인한 속도 저하) |
| **적용 범위**     | 특정 앱 또는 브라우저         | 전체 네트워크 연결             |
| **사용 목적**     | IP 변경, 차단 우회, 속도 향상 | 보안 강화, 데이터 보호         |

---

## **5. 프록시 서버 구축 방법**

### **1) Nginx를 이용한 리버스 프록시 설정**

```bash
bash
복사편집
# Nginx 설치 (Ubuntu 기준)
sudo apt update && sudo apt install nginx

# Nginx 설정 파일 수정 (예: /etc/nginx/sites-available/default)
server {
    listen 80;

    location / {
        proxy_pass http://backend_server_ip:port;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# Nginx 재시작
sudo systemctl restart nginx

```

---

### **2) Squid를 이용한 정방향 프록시 설정**

```bash
bash
복사편집
# Squid 설치 (Ubuntu 기준)
sudo apt update && sudo apt install squid

# Squid 설정 파일 수정 (예: /etc/squid/squid.conf)
http_port 3128
acl localnet src 192.168.1.0/24
http_access allow localnet

# Squid 재시작
sudo systemctl restart squid

```

---

## **6. 프록시 서버의 활용 사례**

- **기업:** 내부 보안 및 직원 인터넷 사용 제어.
- **게임:** 지역 제한이 있는 게임 서버 우회.
- **개발자:** API 호출 시 다른 IP로 요청을 보내기 위해 사용.
- **보안:** DDOS 공격 방지, 방화벽 역할.

---

### **결론**

프록시 서버는 단순한 인터넷 우회 기능뿐만 아니라, 보안, 성능 개선, 로드 밸런싱 등의 다양한 역할을 수행할 수 있습니다. 특히, 기업 환경에서는 보안 및 네트워크 최적화를 위해 필수적인 기술 중 하나입니다. 🚀
